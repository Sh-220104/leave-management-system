{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import LeaveTable from\"../components/LeaveTable\";import axios from\"../api/axios\";// ← FIX: correct path to the axios instance with JWT interceptor\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function ManagerApprovalPage(){const[pending,setPending]=useState([]);const[loading,setLoading]=useState(false);const[resultMsg,setResultMsg]=useState(\"\");// ── Fetch all pending leave requests ────────────────────────────────────────\nconst fetchPendingLeaves=async()=>{setLoading(true);try{const res=await axios.get(\"/leaves/pending\");setPending(res.data);}catch(err){console.error(\"Failed to fetch pending leaves:\",err);setPending([]);}finally{setLoading(false);}};useEffect(()=>{fetchPendingLeaves();},[]);// ── Approve / Reject handler ─────────────────────────────────────────────────\n// isApprove: true  → PUT /leaves/{id}/approve\n// isApprove: false → PUT /leaves/{id}/reject\n// The backend accepts an optional JSON body: { \"comment\": \"...\" }\nconst handleDecision=async function(leaveId,isApprove){let managerComment=arguments.length>2&&arguments[2]!==undefined?arguments[2]:\"\";setLoading(true);setResultMsg(\"\");const action=isApprove?\"approve\":\"reject\";// Build request body — only include comment when non-empty\nconst body=managerComment.trim()?{comment:managerComment.trim()}:{};try{await axios.put(\"/leaves/\".concat(leaveId,\"/\").concat(action),body);const successMsg=isApprove?\"✅ Leave Approved!\":\"❌ Leave Rejected!\";setResultMsg(successMsg);// Optimistically remove the acted-upon request from the pending list\n// then re-fetch to stay in sync with the backend\nsetPending(prev=>prev.filter(l=>l.id!==leaveId));await fetchPendingLeaves();}catch(error){var _error$response,_error$response$data,_error$response2;const serverMsg=((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||((_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.data)||\"An error occurred while updating the leave request.\";setResultMsg(\"\\u26A0\\uFE0F Error: \".concat(serverMsg));console.error(\"Decision error:\",error);}finally{setLoading(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard-section\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Pending Leave Requests\"}),resultMsg&&/*#__PURE__*/_jsx(\"div\",{style:{color:resultMsg.startsWith(\"⚠️\")?\"red\":\"green\",marginBottom:12,fontWeight:600},children:resultMsg}),loading?/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"}):pending.length>0?/*#__PURE__*/_jsx(LeaveTable,{leaveRequests:pending,showActions:true,onAction:handleDecision,loading:loading}):/*#__PURE__*/_jsx(\"div\",{style:{color:\"#666\",marginTop:12},children:\"No pending leave requests.\"})]});}export default ManagerApprovalPage;","map":{"version":3,"names":["React","useEffect","useState","LeaveTable","axios","jsx","_jsx","jsxs","_jsxs","ManagerApprovalPage","pending","setPending","loading","setLoading","resultMsg","setResultMsg","fetchPendingLeaves","res","get","data","err","console","error","handleDecision","leaveId","isApprove","managerComment","arguments","length","undefined","action","body","trim","comment","put","concat","successMsg","prev","filter","l","id","_error$response","_error$response$data","_error$response2","serverMsg","response","message","className","children","style","color","startsWith","marginBottom","fontWeight","leaveRequests","showActions","onAction","marginTop"],"sources":["C:/Users/VuppalaShreya/Downloads/leave-management-system/frontend/src/pages/ManagerApprovalPage.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport LeaveTable from \"../components/LeaveTable\";\r\nimport axios from \"../api/axios\"; // ← FIX: correct path to the axios instance with JWT interceptor\r\n\r\nfunction ManagerApprovalPage() {\r\n  const [pending, setPending] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [resultMsg, setResultMsg] = useState(\"\");\r\n\r\n  // ── Fetch all pending leave requests ────────────────────────────────────────\r\n  const fetchPendingLeaves = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const res = await axios.get(\"/leaves/pending\");\r\n      setPending(res.data);\r\n    } catch (err) {\r\n      console.error(\"Failed to fetch pending leaves:\", err);\r\n      setPending([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchPendingLeaves();\r\n  }, []);\r\n\r\n  // ── Approve / Reject handler ─────────────────────────────────────────────────\r\n  // isApprove: true  → PUT /leaves/{id}/approve\r\n  // isApprove: false → PUT /leaves/{id}/reject\r\n  // The backend accepts an optional JSON body: { \"comment\": \"...\" }\r\n  const handleDecision = async (leaveId, isApprove, managerComment = \"\") => {\r\n    setLoading(true);\r\n    setResultMsg(\"\");\r\n\r\n    const action = isApprove ? \"approve\" : \"reject\";\r\n    // Build request body — only include comment when non-empty\r\n    const body = managerComment.trim() ? { comment: managerComment.trim() } : {};\r\n\r\n    try {\r\n      await axios.put(`/leaves/${leaveId}/${action}`, body);\r\n\r\n      const successMsg = isApprove ? \"✅ Leave Approved!\" : \"❌ Leave Rejected!\";\r\n      setResultMsg(successMsg);\r\n\r\n      // Optimistically remove the acted-upon request from the pending list\r\n      // then re-fetch to stay in sync with the backend\r\n      setPending(prev => prev.filter(l => l.id !== leaveId));\r\n      await fetchPendingLeaves();\r\n    } catch (error) {\r\n      const serverMsg =\r\n        error.response?.data?.message ||\r\n        error.response?.data ||\r\n        \"An error occurred while updating the leave request.\";\r\n      setResultMsg(`⚠️ Error: ${serverMsg}`);\r\n      console.error(\"Decision error:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"dashboard-section\">\r\n      <h2>Pending Leave Requests</h2>\r\n\r\n      {resultMsg && (\r\n        <div\r\n          style={{\r\n            color: resultMsg.startsWith(\"⚠️\") ? \"red\" : \"green\",\r\n            marginBottom: 12,\r\n            fontWeight: 600,\r\n          }}\r\n        >\r\n          {resultMsg}\r\n        </div>\r\n      )}\r\n\r\n      {loading ? (\r\n        <div>Loading...</div>\r\n      ) : pending.length > 0 ? (\r\n        <LeaveTable\r\n          leaveRequests={pending}\r\n          showActions\r\n          onAction={handleDecision}\r\n          loading={loading}\r\n        />\r\n      ) : (\r\n        <div style={{ color: \"#666\", marginTop: 12 }}>\r\n          No pending leave requests.\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default ManagerApprovalPage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}